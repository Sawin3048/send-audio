(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function l(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(t){if(t.ep)return;t.ep=!0;const r=l(t);fetch(t.href,r)}})();const b=()=>{let o=2,n=[];function l(t){let r=t.length,c=new Uint8Array(r*o);for(let u=0;u<r;u++){let i=u*o,e=t[u];e>1?e=1:e<-1&&(e=-1),e=e*32768,c[i]=e,c[i+1]=e>>8}n.push(c)}function a(t){let r=n.length?n[0].length:0,c=n.length*r,u=new Uint8Array(44+c),i=new DataView(u.buffer);i.setUint32(0,1380533830,!1),i.setUint32(4,36+c,!0),i.setUint32(8,1463899717,!1),i.setUint32(12,1718449184,!1),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,1,!0),i.setUint32(24,t,!0),i.setUint32(28,t*o,!0),i.setUint16(32,o,!0),i.setUint16(34,8*o,!0),i.setUint32(36,1684108385,!1),i.setUint32(40,c,!0);for(let e=0;e<n.length;e++)u.set(n[e],e*r+44);n=[],postMessage(u.buffer,[u.buffer])}onmessage=t=>{t.data[0]==="encode"?l(t.data[1]):t.data[0]==="dump"&&a(t.data[1])}};let v=window.AudioContext||window.webkitAudioContext,y=o=>{let n=o.toString().replace(/^(\(\)\s*=>|function\s*\(\))\s*{/,"").replace(/}$/,""),l=new Blob([n]);return new Worker(URL.createObjectURL(l))},f=o=>{let n=new Event("error");return n.data=new Error("Wrong state for "+o),n},m,h=class E{constructor(n,l=null){this.stream=n,this.config=l,this.state="inactive",this.em=document.createDocumentFragment(),this.encoder=y(E.encoder);let a=this;this.encoder.addEventListener("message",t=>{let r=new Event("dataavailable");r.data=new Blob([t.data],{type:a.mimeType}),a.em.dispatchEvent(r),a.state==="inactive"&&a.em.dispatchEvent(new Event("stop"))})}start(n){if(this.state!=="inactive")return this.em.dispatchEvent(f("start"));this.state="recording",m||(m=new v(this.config)),this.clone=this.stream.clone(),this.input=m.createMediaStreamSource(this.clone),this.processor=m.createScriptProcessor(2048,1,1),this.encoder.postMessage(["init",m.sampleRate]),this.processor.onaudioprocess=l=>{this.state==="recording"&&this.encoder.postMessage(["encode",l.inputBuffer.getChannelData(0)])},this.input.connect(this.processor),this.processor.connect(m.destination),this.em.dispatchEvent(new Event("start")),n&&(this.slicing=setInterval(()=>{this.state==="recording"&&this.requestData()},n))}stop(){return this.state==="inactive"?this.em.dispatchEvent(f("stop")):(this.requestData(),this.state="inactive",this.clone.getTracks().forEach(n=>{n.stop()}),this.processor.disconnect(),this.input.disconnect(),clearInterval(this.slicing))}pause(){return this.state!=="recording"?this.em.dispatchEvent(f("pause")):(this.state="paused",this.em.dispatchEvent(new Event("pause")))}resume(){return this.state!=="paused"?this.em.dispatchEvent(f("resume")):(this.state="recording",this.em.dispatchEvent(new Event("resume")))}requestData(){return this.state==="inactive"?this.em.dispatchEvent(f("requestData")):this.encoder.postMessage(["dump",m.sampleRate])}addEventListener(...n){this.em.addEventListener(...n)}removeEventListener(...n){this.em.removeEventListener(...n)}dispatchEvent(...n){this.em.dispatchEvent(...n)}};h.prototype.mimeType="audio/wav";h.isTypeSupported=o=>h.prototype.mimeType===o;h.notSupported=!navigator.mediaDevices||!v;h.encoder=b;const L=()=>{importScripts("https://cdnjs.cloudflare.com/ajax/libs/lamejs/1.2.0/lame.min.js");let o=1,n=128,l=44100,a,t=new Int8Array;function r(e,d){if(d.length===0)return e;let s=new Int8Array(e.length+d.length);return s.set(e),s.set(d,e.length),s}function c(e){a=new lamejs.Mp3Encoder(o,e||l,n)}function u(e){for(let s=0;s<e.length;s++)e[s]=e[s]*32767.5;let d=a.encodeBuffer(e);t=r(t,d)}function i(){let e=a.flush();t=r(t,e);let d=t.buffer;t=new Int8Array,postMessage(d,[d])}onmessage=e=>{e.data[0]==="init"?c(e.data[1]):e.data[0]==="encode"?u(e.data[1]):i(e.data[1])}};h.encoder=L;h.prototype.mimeType="audio/mpeg";window.MediaRecorder=h;alert(MediaRecorder.isTypeSupported("audio/mpeg"));const U=()=>{if(typeof MediaRecorder>"u"||!!!navigator.mediaDevices.getUserMedia)return alert("Tu navegador web no cumple los requisitos");const n=document.querySelector("#listaDeDispositivos"),l=document.querySelector("#btnComenzarGrabacion"),a=document.querySelector("#btnDetenerGrabacion"),t=()=>{for(let e=n.options.length-1;e>=0;e--)n.options.remove(e)};let r;const c=()=>{navigator.mediaDevices.enumerateDevices().then(e=>{console.log(e),t();const d=document.createDocumentFragment();e.forEach((s,g)=>{if(s.kind==="audioinput"){const p=document.createElement("option");p.text=s.label||`Dispositivo ${g+1}`,p.value=s.deviceId,d.appendChild(p)}n.appendChild(d)})})},u=()=>{if(!n.options.length)return alert("No hay dispositivos");if(r)return alert("Ya se está grabando");navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{r=new MediaRecorder(e,{mimeType:"audio/mpeg"}),r.start();const d=[];r.addEventListener("dataavailable",s=>{d.push(s.data)}),r.addEventListener("stop",()=>{e.getTracks().forEach(w=>w.stop()),console.log(d);const s=new Blob(d),g=URL.createObjectURL(s);let p=document.createElement("a");document.body.appendChild(p),p.href=g,p.download="grabacion.mp3",p.click(),window.URL.revokeObjectURL(g)})}).catch(e=>{console.log(e),alert(e)})},i=()=>{if(!r)return alert("No se está grabando");r.stop(),r=null};l.addEventListener("click",u),a.addEventListener("click",i),c()};document.addEventListener("DOMContentLoaded",U);
